<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<style type="text/css">
			html { height: 100% }
			body { height: 100%; margin: 0; padding: 0 }
			#map-canvas { height: 100% }
		</style>
		<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgiFfn7sq6RQy2gXG7BEyxr5qBdkPq_2s">
        </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
    </script>
    <script type="text/javascript">
   
        google.maps.event.addDomListener(window, 'load', initialize);

        function initialize() 
        {      
            var xmlhttp = new XMLHttpRequest();
 //           var url = "http://track-my-trip-dot-minecraft-161209.appspot.com/activities?prefix=Day";
            var url = "http://localhost:8080/activities?prefix=Day"
            console.log('initialize')
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    // console.log('res='+this.responseText)
                    var coords = JSON.parse(this.responseText);
                    var polyline = []
                    coords.forEach(function(element) {
                        polyline.push(new google.maps.LatLng(element[0],element[1]))
                    }, this);
                    // console.log('polyline=',polyline)
                    var lat = parseFloat(coords[coords.length-1][0]);
                    var lng = parseFloat(coords[coords.length-1][1]);
                    // Initialize our Google map
                    var mapOptions = {
                        center: new google.maps.LatLng(lat, lng),
                        zoom: 6,
                        mapTypeId: google.maps.MapTypeId.HYBRID
                    };

                    // Generate the actual map
                    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

                    var flightPath = new google.maps.Polyline({
                        path: polyline,
                        center: new google.maps.LatLng(lat, lng),
                        geodesic: true,
                        strokeColor: '#FF0000',
                        strokeOpacity: 1.0,
                        strokeWeight: 2
                    });
                    console.log('flightPath')
                    flightPath.setMap(map); 
                }
            }
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
  
        }
    </script>
	</head>
	<body>
		<div id="map-canvas"/>
	</body>
</html>